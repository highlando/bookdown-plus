\documentclass[]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[b5paper,tmargin=2.5cm,bmargin=2.5cm,lmargin=3.5cm,rmargin=2.5cm]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={bookdown+: Authoring Articles, Mails, Guitar Chords, Chemical Molecular Formulae and Equations with R bookdown},
            pdfauthor={Peng Zhao},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{natbib}
\bibliographystyle{apalike}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}
  \title{bookdown+: Authoring Articles, Mails, Guitar Chords, Chemical Molecular
Formulae and Equations with R bookdown}
  \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  \author{Peng Zhao}
  \preauthor{\centering\large\emph}
  \postauthor{\par}
  \predate{\centering\large\emph}
  \postdate{\par}
  \date{2017-05-09}

\usepackage[version=4]{style/mhchem2}
%\usepackage{latex/hpstatement}
%\usepackage{latex/rsphrase}
%\usepackage{latex/chemgreek}
%\usepackage{latex/expl3}

%\usepackage{tikz}
%\usepgflibrary{arrows.meta}

\usepackage[collision]{style/chemsym}
\usepackage{hetarom,carom,epic,ccycle,aliphat}

\usepackage{booktabs}
\usepackage{longtable}

\usepackage{framed,color}
\definecolor{shadecolor}{RGB}{248,248,248}

\renewcommand{\textfraction}{0.05}
\renewcommand{\topfraction}{0.8}
\renewcommand{\bottomfraction}{0.8}
\renewcommand{\floatpagefraction}{0.75}

\let\oldhref\href
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}

\iffalse

\makeatletter
\newenvironment{kframe}{%
\medskip{}
\setlength{\fboxsep}{.8em}
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\renewenvironment{Shaded}{\begin{kframe}}{\end{kframe}}

\fi

\usepackage{makeidx}
\makeindex

\urlstyle{tt}

\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\usepackage{booktabs}
\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\begin{document}
\maketitle

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\chapter{Introduction}\label{introduction}

\chapter{Demos}\label{demos}

\section{Chemical formulae}\label{chemical-formulae}

\ce{H2O}, \ce{Sb2O3}

\ce{H+}, \ce{CrO4^2-}, \ce{[AgCl2]-}, \ce{Y^99+}, \ce{Y^{99+}}

\ce{Fe^{II}Fe^{III}2O4}, \ce{2H2O}, \ce{2 H2O}, \ce{0.5H2O},
\ce{1/2H2O}, \ce{(1/2)H2O} , \ce{$n$H2O}

\ce{^{227}_{90}Th+}, \ce{^227_90Th+}, \ce{^{0}_{-1}n^{-}}, \ce{^0_-1n-}

\ce{H{}^3HO}, \ce{H^3HO}

\ce{(NH4)2S}, \ce{[\{(X2)3\}2]^3+}

\ce{H2(aq)}, \ce{CO3^2-{}_{(aq)}}, \ce{NaOH(aq,$\infty$)}

\ce{OCO^{.-}}, \ce{NO^{(2.)-}}

\(\ce{NO_x}\),
\texttt{\textbackslash{}sffamily\textbackslash{}bfseries\textbackslash{}ce\{NO\_x\}},
\(\ce{Fe^n+}\),
\texttt{\textbackslash{}sffamily\textbackslash{}bfseries\textbackslash{}ce\{Fe\^{}n+\}}

\texttt{\textbackslash{}ce\{\textbackslash{}mu-Cl\},\ \textbackslash{}ce\{{[}Pt(\textbackslash{}eta\^{}2-C2H4)Cl3{]}-\}}

\ce{KCr(SO4)2*12H2O}, \ce{KCr(SO4)2.12H2O}, \ce{KCr(SO4)2 * 12 H2O}

\ce{C6H5-CHO}, \ce{A-B=C#D},
\texttt{\textbackslash{}sffamily\textbackslash{}bfseries\textbackslash{}ce\{A-B=C\#D\}}

\ce{A\bond{-}B\bond{=}C\bond{#}D}, \ce{A\bond{~}B\bond{~-}C},
\ce{A\bond{~--}B\bond{~=}C\bond{-~-}D}, \ce{A\bond{...}B\bond{....}C},
\ce{A\bond{->}B\bond{<-}C}

\section{Chemical equations}\label{chemical-equations}

\ce{A -> B}

\ce{A <- B}

\ce{A <-> B}

\ce{A <--> B}

\ce{A <=> B}

\ce{A <=>> B}

\ce{A <<=> B}

\ce{A ->[\ce{H2O}] B}

\ce{A ->[{text above}][{text below}] B}

\ce{A ->[x][x_i] B}

\ce{A ->[x] B}

\ce{A + B}

\ce{A - B}

\ce{A = B}

\ce{A \pm B}

\ce{SO4^2- + Ba^2+ -> BaSO4 v}

\ce{A v B (v) -> B ^ B (^)}

\(\ce{CH4} + 2\left( \ce{O2 + 79/21 N2} \right)\)

\(\ce{x Na(NH4)HPO4 ->[\Delta] (NaPO3)_x + x NH3 ^ + x H2O}\)

\ce{CO2 + C -> 2 CO}

\ce{Hg^2+ ->[I-] HgI2
            ->[I-] [Hg^{II}I4]^2-}

\ce{Zn^2+ ->[\ce{+ 2OH-}][\ce{+ 2H+}] Zn(OH)2 v <=>[\ce{+ 2OH-}][\ce{+ 2H+}] [Zn(OH)4]^2-}

\(K = \frac{[\ce{Hg^2+}][\ce{Hg}]}{[\ce{Hg2^2+}]}\)

\(K = \ce{\frac{[Hg^2+][Hg]}{[Hg2^2+]}}\)

\section{Structural formulae}\label{structural-formulae}

\bzdrh{1==Br;4==Br} \bzdrv{1==Br;4==Br} \bzdrv[l]{1==Br;4==Br}
\bzdrv[c]{1==Br;4==Br}

\bzdrv[pa]{1D==O;4D==%
\lmoiety{CH$_{3}$SO$_{2}$--N};%
2==CH$_{3}$} \bzdrv[pa]{1D==O;4D==%
\rmoiety{N--SO$_{2}$CH$_{3}$};%
2==CH$_{3}$}

\cyclohexanev{1==1;%
2d==2D;%
3A==3A;%
4B==4B;%
5Sa==5Sa;5Sb==5Sb;%
6Sa==6Sa;6Sb==6Sb}

\cyclohexaneh
[bdf]{1==Br;4==Br} \cyclohexanev
[A]{1==Br;4==Br}

\sixheterov[eb]{1==N}
{1D==0;
4SA==MeO;4SB==OMe;
5==C1;
6==Cl} \threehetero[H]{2==C}
{2Sa==COOH;2Sb==COOH}

\pyrazinev[l{1+}{4+}]
{1==H;4==H;2==Cl;6==Cl}

\cyclohexanev
{1D==O;2Sa==F;2Sb==F} \cyclohexaneh[c]
{1==Cl;4==F;2==CH$_{3}$}

\naphdrv[ob]
{1Sb==Br;1Sa==Br;3D==O} \naphdrh[A]
{1==Cl;4==F;2==CH$_{3}$}

\decaheterov[af]{4==O}
{1==CH$_3$;6==H$_3$C;9A==H;%
{{10}A}==\lmoiety{HOCH$_2$}} \nonaheterov[bjge]{1==S;2==N}{3==Cl}

\chair{1D==O;%
2Se==H$_3$C;2Sa==CH$_3$;%
6Se==CH$_3$;6Sa==CH$_3$}

\tetrahedral{0==C;1D==O;2==Cl;%
4==Cl} \qquad
\tetrahedral[{0+}]{0==N;%
1==H;2==CH$_3$;3==H;4==H}

\rtrigonal{0==C;1D==O;2==Cl;3==F} \qquad
\ltrigonal{0==C;1D==O;2==Cl;3==F} \utrigonal{0==C;1D==O;2==Cl;3==F}
\Utrigonal{0==C;1D==O;2==Cl;3==F} \dtrigonal{0==C;1D==O;2==Cl;3==F}
\qquad
\Dtrigonal{0==C;1D==O;2==Cl;3==F}

\ethylene{1==C;2==C}
{1==F;2==Cl;3==H;4==Br} \qquad
\ethylenev[t{2+}]{1==C;2==N}
{1==H$_3$C;2==CH$_3$;3==H}

\bibliography{bib/bib}


\end{document}
